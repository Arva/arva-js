<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/utils/DebuggerTools.js | Arva</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-styles.css"><meta name="description" content="this is awesome library"><meta property="og:type" content="website"><meta property="og:url" content="http://arva.io"><meta property="og:site_name" content="Arva"><meta property="og:title" content="Arva"><meta property="og:image" content="http://arva.io/img/logo-arva.png"><meta property="og:description" content="this is awesome library"><meta property="og:author" content="https://twitter.com/arvamazing"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Arva"><meta property="twitter:description" content="this is awesome library"><meta property="twitter:image" content="http://arva.io/img/logo-arva.png"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Arva/arva-js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/DataBoundScrollView.js~DataBoundScrollView.html">DataBoundScrollView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Dialog.js~Dialog.html">Dialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ReflowingScrollView.js~ReflowingScrollView.html">ReflowingScrollView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core">core</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Controller.js~Controller.html">Controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/ScrollController.js~ScrollController.html">ScrollController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data">data</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/PrioritisedArray.js~PrioritisedArray.html">PrioritisedArray</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-local">data/local</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/local/LocalModel.js~LocalModel.html">LocalModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/local/LocalPrioritisedArray.js~LocalPrioritisedArray.html">LocalPrioritisedArray</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#layout">layout</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/layout/Decorators.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/layout/Decorators.js~Flow.html">Flow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/layout/Decorators.js~Layout.html">Layout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dynamic">dynamic</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-decoratorTypes">decoratorTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-bindings">bindings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-event">event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-flow">flow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-layout">layout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-flowStates">flowStates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StickTypes">StickTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StickTypes">StickTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-dockBottom">dockBottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-dockLeft">dockLeft</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-dockRight">dockRight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-dockTop">dockTop</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-fill">fill</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routers">routers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/routers/ArvaRouter.js~ArvaRouter.html">ArvaRouter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#surfaces">surfaces</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surfaces/AudioSurface.js~AudioSurface.html">AudioSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surfaces/Dropdown.js~Dropdown.html">Dropdown</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surfaces/InputSurface.js~InputSurface.html">InputSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surfaces/PushDownSurface.js~PushDownSurface.html">PushDownSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surfaces/WebGLSurface.js~WebGLSurface.html">WebGLSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BgImageSurface">BgImageSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Surface">Surface</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/BlobHelper.js~BlobHelper.html">BlobHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/DialogManager.js~DialogManager.html">DialogManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/Injection.js~Injection.html">Injection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/KeyboardHelper.js~KeyboardHelper.html">KeyboardHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/ObjectHelper.js~ObjectHelper.html">ObjectHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/Throttler.js~Throttler.html">Throttler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-callbackToPromise">callbackToPromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-successAndErrorToPromise">successAndErrorToPromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-waitMilliseconds">waitMilliseconds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combineOptions">combineOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-limit">limit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Easing">Easing</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils-dialog">utils/dialog</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/dialog/DialogWrapper.js~DialogWrapper.html">DialogWrapper</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils-hotfixes">utils/hotfixes</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-invalidateLayoutForElement">invalidateLayoutForElement</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils-view">utils/view</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/ArrayObserver.js~ArrayObserver.html">ArrayObserver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/ArrayObserver.js~MappedArray.html">MappedArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/InputOption.js~InputOption.html">InputOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~BaseLayoutHelper.html">BaseLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~DockedLayoutHelper.html">DockedLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~FullSizeLayoutHelper.html">FullSizeLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~TraditionalLayoutHelper.html">TraditionalLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LazyLoadedOptionClone.js~LazyLoadedOptionClone.html">LazyLoadedOptionClone</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/OptionObserver.js~OptionObserver.html">OptionObserver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/RenderableHelper.js~RenderableHelper.html">RenderableHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/SizeResolver.js~SizeResolver.html">SizeResolver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/Utils.js~Utils.html">Utils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-changeValue">changeValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onOptionChange">onOptionChange</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/utils/DebuggerTools.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Created by lundfall on 06/07/2017.
 */
import {Surface}            from &apos;arva-js/surfaces/Surface.js&apos;;
import SpecParser           from &apos;famous/core/SpecParser.js&apos;
import Entity               from &apos;famous/core/Entity.js&apos;
import RenderNode           from &apos;famous/core/RenderNode.js&apos;
import { View }             from &apos;arva-js/core/View.js&apos;
import { PrioritisedArray } from &apos;arva-js/data/PrioritisedArray.js&apos;
import { ObjectHelper }     from &apos;arva-js/utils/ObjectHelper.js&apos;
import { OptionObserver }   from &apos;arva-js/utils/view/OptionObserver.js&apos;
import { Utils }            from &apos;arva-js/utils/view/Utils.js&apos;
import { layout }           from &apos;arva-js/layout/Decorators.js&apos;
import EventEmitter         from &apos;famous/core/EventEmitter.js&apos;

window.getFromID = (id) =&gt; {
  return Entity.get(id)
};

window.views = {};
window.prioArrays = {};


window.muteLogs = true;

window.debugSizes = false;

let originalGetSize = View.prototype.getSize;
View.prototype.getSize = function () {
    if(!window.debugSizes){
        return originalGetSize.call(this, ...arguments);
    }
    console.group(this.constructor.name);
    let returnValue = originalGetSize.call(this, ...arguments);
    console.log(returnValue);
    console.groupEnd(this.constructor.name);
    return returnValue;
};

let originalCopyPrototypeProperties= View.prototype._copyPrototypeProperties;
View.prototype._copyPrototypeProperties = function () {
  window.views[this._name()] = this;
  return originalCopyPrototypeProperties.call(this, ...arguments)
};

let originalBuildFromSnapshot = PrioritisedArray.prototype._buildFromSnapshot;
PrioritisedArray.prototype._buildFromSnapshot = function () {
    window.prioArrays[this.constructor.name] = this;
    return originalBuildFromSnapshot.call(this, ...arguments)
};

let originalConstructLayoutController = View.prototype._createLayoutController;
View.prototype._createLayoutController = function () {
  originalConstructLayoutController.call(this, ...arguments)
  this.layout._view = this
};

let secretRedBackground = Symbol(&apos;secretRedBackground&apos;);
View.prototype.makeRED = function () {
  this._arrangeRenderableAssignment(this[secretRedBackground], Surface.with({properties: {backgroundColor: &apos;red&apos;}}),
    [], secretRedBackground, [layout.fullSize()])
  this.reflowRecursively();
};

let originalWarn = Utils.warn;
Utils.warn = function () {
  originalWarn.call(this, ...arguments);
  debugger;
};

let originaloptionObserverErrorThrower = OptionObserver.prototype._throwError;
OptionObserver.prototype._throwError = function (message) {
    console.log(message);
  debugger;
  return originaloptionObserverErrorThrower.call(this, ...arguments)
}


let log = (...consoleArgs) =&gt; {
  if(window.muteLogs){
    return
  }
  console.log(...consoleArgs);
}


let originalRegisterNewInstance = OptionObserver._registerNewInstance
OptionObserver._registerNewInstance = function (instance) {
  instance.on(&apos;needUpdate&apos;, (renderableName) =&gt; {
    log(`%c ${instance._errorName}:${renderableName} is invalidated`, &apos;color: rgba(125, 125, 125, 0.7&apos;)
  })
  return originalRegisterNewInstance.call(this, ...arguments)
};

let originalOptionObserverMarkPropertyAsUpdated = OptionObserver.prototype._markPropertyAsUpdated
OptionObserver.prototype._markPropertyAsUpdated = function (nestedPropertyPath, property, value) {
  let result = originalOptionObserverMarkPropertyAsUpdated.call(this, ...arguments)
  log(`%c ${this._errorName} updated ${nestedPropertyPath.concat(property).join(&apos;-&gt;&apos;)}=${Utils.isPlainObject(value) ? JSON.stringify(value) : value}`, &apos;color: green&apos;)
  return result
};

window.ObjectHelper = ObjectHelper;

let originalEmit = EventEmitter.prototype.emit;
EventEmitter.prototype.emit = function (type) {
  let result = originalEmit.call(this, ...arguments)
  if (typeof document.body[&apos;on&apos; + type] === &apos;undefined&apos; &amp;&amp; ![
    /* Exclude common events that emit too often */
      &apos;layoutstart&apos;,
      &apos;layoutend&apos;,
      &apos;sizeChanged&apos;,
      &apos;reflow&apos;,
      &apos;start&apos;,
      &apos;newSize&apos;,
      &apos;end&apos;,
      &apos;update&apos;,
      &apos;layoutControllerReflow&apos;,
      &apos;deploy&apos;,
      &apos;recursiveReflow&apos;,
      &apos;postrender&apos;,
      &apos;prerender&apos;,
      &apos;change&apos;].includes(type) &amp;&amp; Number.isNaN(+type)) {
    log(`Event emitted: ${type}`, this._owner)
  }
  return result
};

//TODO Support a more abd ass version of this using proxies
window.observePropertySet = (object, propertyName) =&gt; {
  let value = object[propertyName];
  Object.defineProperty(object, propertyName, {get: () =&gt; value, set: (newValue) =&gt; {
    value = newValue;
    debugger; }, enumerable: false})
};

let viewDebugSettings = new Map();
window.unDebugLayoutFunction = (view) =&gt; {
    let settings = viewDebugSettings.get(view.constructor);
    settings.debug = false;
};
window.debugLayoutFunction = (view) =&gt; {
    let settings = {debug: true};
    view._doReflow();
    if(viewDebugSettings.get(view)){
        return;
    }
    viewDebugSettings.set(view, settings);
    let originalLayoutFunction = view._layoutDecoratedRenderables;
    view._layoutDecoratedRenderables = function() {
        if(settings.debug){
            debugger;
        }
        originalLayoutFunction.call(view, ...arguments);
    };
};

let surfaceDebugSettings = new Map();
window.unDebugCommitFunction = (renderable) =&gt; {
    let settings = surfaceDebugSettings.get(renderable);
    settings.debug = false;
};

window.debugCommitFunction = (renderable) =&gt; {
    let settings = {debug: true};
    if(surfaceDebugSettings.get(renderable)){
        return;
    }
    surfaceDebugSettings.set(renderable, settings);
    let originalCommitFunction = renderable.commit;
    renderable.commit = function() {
        if(settings.debug){
            debugger;
        }
        originalCommitFunction.call(renderable, ...arguments);
    };
};

window.debugFunction = (object, name) =&gt; {
    let originalFunction = object[name];
    object[name] = function() {
        debugger;
        originalFunction.call(object, ...arguments);
    };
};


RenderNode._applyCommit = (spec, context, cacheStorage, nestedList = []) =&gt; {
    var result = SpecParser.parse(spec, context);
    var keys = Object.keys(result);
    for (var i = 0; i &lt; keys.length; i++) {
        var id = keys[i];
        var childNode = Entity.get(id);
        var commitParams = result[id];
        commitParams.allocator = context.allocator;
        var commitResult = childNode.commit(commitParams);
        if (commitResult) {
            var thingsToAdd = childNode.__hiddenViewName__ ? [childNode.__hiddenViewName__] :  [];
            thingsToAdd = thingsToAdd.concat(childNode._view &amp;&amp; childNode._view.__hiddenRenderableName__ || [])
            /* Replace white space since adding white space to a class name causes the DOM to revolt */
                .map((string) =&gt; string.replace(&apos; &apos;, &apos;&apos;));
            RenderNode._applyCommit(commitResult, context, cacheStorage, nestedList.concat(thingsToAdd));
        } else {
            cacheStorage[id] = commitParams;
            childNode.setAttributes &amp;&amp; childNode.setAttributes({&apos;data-name&apos;: childNode.__hiddenRenderableName__ || &apos;&apos;});
            childNode.setClasses &amp;&amp; childNode.setClasses(nestedList);
        }
    }
};

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
