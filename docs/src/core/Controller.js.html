<!DOCTYPE html>
<html>
<head>
  <title>Controller.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "Users/mysim1/Development/Projects/arva-mvc/src/core/Controllerjs", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>Controller.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>This Source Code is licensed under the MIT license. If a copy of the
MIT-license was not distributed with this file, You can obtain one at:
<a href='http://opensource.org/licenses/mit-license.html'>http://opensource.org/licenses/mit-license.html</a>.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">author:</div>
    <div class="dox_tag_detail">
      <span>Hans van den Akker (mysim1)</span>
    </div>
    <div class="dox_tag_title">license</div>
    <div class="dox_tag_detail">
      <span>MIT</span>
    </div>
    <div class="dox_tag_title">copyright</div>
    <div class="dox_tag_detail">
      <span>Bizboard, 2015</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kr">import</span> <span class="nx">_</span>                    <span class="nx">from</span> <span class="s1">&#39;lodash&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Inject</span><span class="p">}</span>             <span class="nx">from</span> <span class="s1">&#39;di.js&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Router</span><span class="p">}</span>             <span class="nx">from</span> <span class="s1">&#39;./Router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">ObjectHelper</span><span class="p">}</span>       <span class="nx">from</span> <span class="s1">&#39;arva-utils/ObjectHelper&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">EventHandler</span>         <span class="nx">from</span> <span class="s1">&#39;famous/core/EventHandler&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AnimationController</span>  <span class="nx">from</span> <span class="s1">&#39;famous-flex/src/AnimationController&#39;</span><span class="p">;</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>The Controller class provides the highest level of control regarding the application features. Within the Controller context
each method will registered to receive calls from the Routing engine. With direct access to the Famo.us Context, every method can
control the creation of Views and Transitions.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="err">@</span><span class="nx">Inject</span><span class="p">(</span><span class="nx">Router</span><span class="p">,</span> <span class="nx">AnimationController</span><span class="p">)</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="nx">constructor</span><span class="p">(</span><span class="nx">router</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">spec</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>super();</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">spec</span> <span class="o">=</span> <span class="nx">spec</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventHandler</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>register the controller object in the router
this.router.controllers.push(this);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


        <span class="nx">ObjectHelper</span><span class="p">.</span><span class="nx">bindAllMethods</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>add the controller route to the router</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">routeName</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">routeName</span> <span class="o">+=</span> <span class="s1">&#39;/:method&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>handle router url changes and execute the appropiate controller method</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">routeName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onRouteCalled</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">onRouteCalled</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">[</span><span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">values</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;renderstart&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="k">instanceof</span> <span class="nx">Promise</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// we can assume the method called was asynchronous from nature, therefore we await the result</span>

                    <span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">delegatedresult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>assemble a callback based on the execution scope and have that called when rendering is completed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                        <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">delegatedresult</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">spec</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">spec</span><span class="p">),</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;renderend&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>
                        <span class="p">});</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;rendering&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>assemble a callback based on the execution scope and have that called when rendering is completed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">spec</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">spec</span><span class="p">),</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;renderend&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>
                    <span class="p">});</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;rendering&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>
                <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>assemble a callback based on the execution scope and have that called when rendering is completed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">spec</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">spec</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;renderend&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span> <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_eventOutput</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;rendering&#39;</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Route does not exist!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
