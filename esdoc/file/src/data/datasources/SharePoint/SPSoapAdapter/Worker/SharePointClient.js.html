<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../../../">
  <title data-ice="title">src/data/datasources/SharePoint/SPSoapAdapter/Worker/SharePointClient.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
<link data-ice="userStyle" rel="stylesheet" href="user/css/0-styles.css">
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/DataBoundScrollView.js~DataBoundScrollView.html">DataBoundScrollView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ReflowingScrollView.js~ReflowingScrollView.html">ReflowingScrollView</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/inputs</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/inputs/SingleLineTextInput.js~SingleLineTextInput.html">SingleLineTextInput</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components/logic/branding</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/logic/branding/BrandingEngine.js~BrandingEngine.html">BrandingEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/logic/branding/BrandingEngineSingleton.js~BrandingEngineSingleton.html">BrandingEngineSingleton</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">core</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Controller.js~Controller.html">Controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/DataSource.js~DataSource.html">DataSource</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/PrioritisedArray.js~PrioritisedArray.html">PrioritisedArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/PrioritisedObject.js~PrioritisedObject.html">PrioritisedObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/Snapshot.js~Snapshot.html">Snapshot</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data/datasources</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/FirebaseDataSource.js~FirebaseDataSource.html">FirebaseDataSource</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePointDataSource.js~SharePointDataSource.html">SharePointDataSource</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data/datasources/SharePoint</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/DataModelGenerator.js~DataModelGenerator.html">DataModelGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/SharePointSnapshot.js~SharePointSnapshot.html">SharePointSnapshot</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data/datasources/SharePoint/SPSoapAdapter</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/SPSoapAdapter/Settings.js~Settings.html">Settings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/SPSoapAdapter/SharePoint.js~SharePoint.html">SharePoint</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data/datasources/SharePoint/SPSoapAdapter/Worker</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/SPSoapAdapter/Worker/SharePointClient.js~SharePointClient.html">SharePointClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/datasources/SharePoint/SPSoapAdapter/Worker/SoapClient.js~SoapClient.html">SoapClient</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">data/local</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/local/LocalModel.js~LocalModel.html">LocalModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/local/LocalPrioritisedArray.js~LocalPrioritisedArray.html">LocalPrioritisedArray</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">layout</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-event._subscribe">event._subscribe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-event.on">event.on</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-event.once">event.once</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-event.pipe">event.pipe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout._dockTo">layout._dockTo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.align">layout.align</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.animate">layout.animate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.clip">layout.clip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.custom">layout.custom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.bottom">layout.dock.bottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.fill">layout.dock.fill</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.left">layout.dock.left</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.none">layout.dock.none</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.right">layout.dock.right</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dock.top">layout.dock.top</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dockPadding">layout.dockPadding</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.dockSpace">layout.dockSpace</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.draggable">layout.draggable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.flow">layout.flow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.fullSize">layout.fullSize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.left">layout.left</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.opacity">layout.opacity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.origin">layout.origin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.renderable">layout.renderable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.rotate">layout.rotate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.rotateFrom">layout.rotateFrom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.scale">layout.scale</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.scrollable">layout.scrollable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.size">layout.size</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.skew">layout.skew</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.swipable">layout.swipable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.translate">layout.translate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-layout.translateFrom">layout.translateFrom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TrueSizedLayoutDockHelper">TrueSizedLayoutDockHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-event">event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-flow">flow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-layout">layout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-flowStates">flowStates</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routers</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/routers/ArvaRouter.js~ArvaRouter.html">ArvaRouter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/BlobHelper.js~BlobHelper.html">BlobHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/DialogManager.js~DialogManager.html">DialogManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/Injection.js~Injection.html">Injection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/KeyboardHelper.js~KeyboardHelper.html">KeyboardHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/ObjectHelper.js~ObjectHelper.html">ObjectHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/Throttler.js~Throttler.html">Throttler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-callbackToPromise">callbackToPromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-successAndErrorToPromise">successAndErrorToPromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-waitMilliseconds">waitMilliseconds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combineOptions">combineOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-limit">limit</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils/di</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~ClassProvider.html">ClassProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~FactoryProvider.html">FactoryProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~Inject.html">Inject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~Provide.html">Provide</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~SuperConstructor.html">SuperConstructor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/Decorators.js~TransientScope.html">TransientScope</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/di/injector.js~Injector.html">Injector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-annotate">annotate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hasAnnotation">hasAnnotation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-inject">inject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-provide">provide</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readAnnotations">readAnnotations</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createProviderFromFnOrClass">createProviderFromFnOrClass</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isFunction">isFunction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isObject">isObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isUpperCase">isUpperCase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toString">toString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ownKeys">ownKeys</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils/request</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ExistsRequest">ExistsRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GetRequest">GetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PostRequest">PostRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UrlParser">UrlParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ParseStringToXml">ParseStringToXml</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils/view</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~BaseLayoutHelper.html">BaseLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~DockedLayoutHelper.html">DockedLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~FullSizeLayoutHelper.html">FullSizeLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/LayoutHelpers.js~TraditionalLayoutHelper.html">TraditionalLayoutHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/RenderableHelper.js~RenderableHelper.html">RenderableHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/SizeResolver.js~SizeResolver.html">SizeResolver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/view/Utils.js~Utils.html">Utils</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/data/datasources/SharePoint/SPSoapAdapter/Worker/SharePointClient.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Created by mysim1 on 13/06/15.
 */
import _                from &apos;lodash&apos;;
import EventEmitter     from &apos;eventemitter3&apos;;
import {SoapClient}     from &apos;./SoapClient.js&apos;;
import {Settings}       from &apos;../Settings.js&apos;;
import {ExistsRequest}  from &apos;../../../../../utils/request/RequestClient.js&apos;;
import {UrlParser}      from &apos;../../../../../utils/request/UrlParser.js&apos;;

// setup the soapClient.
var soapClient = new SoapClient();
var window = this;
var global = this;
var tempKeys = [];

export class SharePointClient extends EventEmitter {

    get refreshTimer() {
        return this._refreshTimer;
    }

    set refreshTimer(value) {
        this._refreshTimer = value;
    }

    constructor(options) {
        super();

        this.settings = options;
        this.interval = 3000;
        this.retriever = null;
        this.cache = [];
        this.hasNoServerResponse = true;
        this._active = false;
    }

    init() {
        try {
            let {settings, isChild} = this._initializeSettings(this.settings);
            this.settings = settings;
            this.isChild = isChild;

            this._handleInit(this.settings);
        } catch (exception) {
            this.dispose();
        }
    }

    set(options) {
        return this._handleSet(options);
    }

    remove(options) {
        return this._handleRemove(options);
    }

    dispose() {
        clearTimeout(this.refreshTimer);
        this.refreshTimer = null;
        this._active = false;
    }

    getAuth() {
        return new Promise((resolve, reject) =&gt; {
            /* initialize with SharePoint configuration */
            let configuration = this._getUserGroupDefaultConfiguration();

            /* Append the listName to the URL for easy debugging */
            configuration.url = `${this.settings.endPoint}/${this._getUserGroupService()}?view=getUserGroup`;

            soapClient.call(configuration).then((result) =&gt; {
                let data = result.data[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].GetCurrentUserInfoResponse[0].GetCurrentUserInfoResult[0].GetUserInfo[0].User[0].$;
                let user = {
                    uid: data.ID,
                    name: data.Name,
                    email: data.Email
                };
                resolve(user);
            }).catch((error) =&gt; reject(error));
        });
    }

    subscribeToChanges() {
        if (!this.isChild) {
            /* Don&apos;t monitor child item updates/removes. We only do that on parent arrays. */
            if (!this._active) {
                this._active = true;
                this._refresh();
            }
        }
    }

    _initializeSettings(args) {

        // rebuild endpoint from polling server and interpreting response
        let url = UrlParser(args.endPoint);
        if (!url) throw new Error(&apos;Invalid DataSource path provided!&apos;);

        let newPath = url.protocol + &apos;://&apos; + url.host + &apos;/&apos;;
        let pathParts = url.path.split(&apos;/&apos;);
        let identifiedParts = [];

        let isChild = this._isChildItem(url.path);

        if (!isChild) {
            /* We can always remove the last part of the path, since it will be a list name (which we don&apos;t need in the sharepoint URL). */
            identifiedParts.unshift(pathParts.splice(pathParts.length - 1, 1)[0]);

            try {
                while (!ExistsRequest(newPath + pathParts.join(&apos;/&apos;) + &apos;/&apos; + this._getListService())) {
                    identifiedParts.unshift(pathParts.splice(pathParts.length - 1, 1)[0]);
                }
            } catch (error) {
                console.log(&apos;SharePoint URL detection error:&apos;, error);
            }
        } else {
            /* We&apos;re initializing a child element that has an array-based parent.
             * This means we can&apos;t automatically find the correct SharePoint path, and we&apos;ll have to assume the listName and itemId. */
            identifiedParts[0] = pathParts[pathParts.length - 2];
            identifiedParts[1] = pathParts[pathParts.length - 1];
            pathParts.splice(pathParts.length - 2, 2);
            /* Remove the child ID from the endpoint so we can modify its value through the parent endpoint. */
        }

        if (identifiedParts.length &lt; 1) {
            throw {
                endPoint: pathParts.join(&apos;/&apos;) + &apos;/&apos; + identifiedParts[0],
                message: &apos;Parameters could not be correctly extracted for polling. Assuming invalid state.&apos;
            }
        }
        else {
            let resultconfig = {
                endPoint: newPath + pathParts.join(&apos;/&apos;),
                listName: identifiedParts[0],
                itemId: identifiedParts[1]
            };


            _.extend(resultconfig, _.pick(args, [&apos;query&apos;, &apos;limit&apos;, &apos;orderBy&apos;, &apos;pageSize&apos;]));

            return {settings: resultconfig, isChild: isChild};
        }
    }

    /**
     * Start reading the list from SharePoint and only retrieve changes from last polling timestamp.
     * @param args
     * @private
     */
    _handleInit(args) {

        if (!args.listName) return;

        // initialize with SharePoint configuration
        this.retriever = this._getListItemsDefaultConfiguration();

        /* Append the listName to the URL for easy debugging */
        this.retriever.url = this._parsePath(args.endPoint, this._getListService()) + `?view=${args.listName}`;
        this.retriever.params = {
            &apos;listName&apos;: args.listName,
            &apos;viewFields&apos;: {
                &apos;ViewFields&apos;: &apos;&apos;
            },
            //&apos;since&apos;: new Date(0).toISOString(),
            &apos;queryOptions&apos;: {
                &apos;QueryOptions&apos;: {
                    &apos;IncludeMandatoryColumns&apos;: &apos;FALSE&apos;,
                    &apos;ViewAttributes&apos;: {
                        &apos;_Scope&apos;: &apos;RecursiveAll&apos;
                    }
                }
            }
        };

        if (args.query) {
            this.retriever.params.query = args.query;
        }

        if (args.orderBy) {
            if (this.retriever.params.query) {
                this.retriever.params.query.OrderBy = {
                    &quot;FieldRef&quot;: {
                        &quot;_Ascending&quot;: &quot;TRUE&quot;,
                        &quot;_Name&quot;: args.orderBy
                    }
                };
            }
            else {
                this.retriever.params.query = {
                    Query: {
                        OrderBy: {
                            &quot;FieldRef&quot;: {
                                &quot;_Ascending&quot;: &quot;TRUE&quot;,
                                &quot;_Name&quot;: args.orderBy
                            }
                        }
                    }
                };
            }
        }


        let rowLimit;
        this.explicitRowLimit = args.limit !== undefined;
        if (this.explicitRowLimit) {
            rowLimit = this.explicitRowLimit = args.limit;
        }
        if (args.pageSize) {
            rowLimit = args.pageSize;
            this.pageSize = args.pageSize;
        }
        if (rowLimit) {
            this.retriever.params.rowLimit = rowLimit;
        }
    }

    _isLimitExceeded() {
        return this.explicitRowLimit !== false &amp;&amp; this.cache.length &gt;= this.explicitRowLimit;
    }


    /**
     *
     * Refresh SharePoint with latest changes.
     * @param {Boolean} calledManually If set to false, ignores any existing timer in this.refreshTimer and executes the refresh regardless.
     * @private
     */
    _refresh() {
        if (this.retriever) {
            if (this._isLimitExceeded()) {
                this.retriever.params.rowLimit = this.explicitRowLimit;
            }
            soapClient.call(this.retriever, tempKeys)
                .then((result) =&gt; {


                    let listItem = result.data[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].GetListItemChangesSinceTokenResponse[0].GetListItemChangesSinceTokenResult[0].listitems[0];
                    let hasDeletions = false;
                    if (listItem.Changes) {
                        let changes = listItem.Changes[0];
                        hasDeletions = this._handleDeleted(changes);
                    }

                    let data = this._getResults(result.data);
                    let messages = this._updateCache(data);

                    this._handleNextToken(listItem);

                    /* If any data is new or modified, emit a &apos;value&apos; event. */
                    if (hasDeletions || data.length &gt; 0) {
                        this.emit(&apos;message&apos;, {event: &apos;value&apos;, result: this.cache});

                    } else if (this.hasNoServerResponse) {
                        /* If there is no data, and this is the first time we get a response from the server,
                         * emit a value event that shows subscribers that there is no data at this path. */
                        this.emit(&apos;message&apos;, {event: &apos;value&apos;, result: null});
                    }

                    if (!this.hasNoServerResponse) {
                        /* Emit any added/changed events. */
                        for (let message of messages) {
                            this.emit(&apos;message&apos;, message);
                        }
                    }
                    this.hasNoServerResponse = false;
                    if (this._active) {
                        this.refreshTimer = setTimeout(this._refresh.bind(this), this.interval);
                    }

                }).catch((err) =&gt; {
                this.emit(&apos;error&apos;, err);
                if (this._active) {

                    this.refreshTimer = setTimeout(this._refresh.bind(this), this.interval);
                }

            });
        }
    }


    /**
     * Add or Update a data record.
     * @private
     */
    _handleSet(newData) {
        var configuration = this._updateListItemsDefaultConfiguration();
        /* Append the listName to the URL for easy debugging */
        configuration.url = this._parsePath(this.settings.endPoint, this._getListService()) + `?update=${this.settings.listName}`;
        var fieldCollection = [];
        var method = &apos;&apos;;

        let isLocal = _.findIndex(tempKeys, function (key) {
            return key.localId == newData.id;
        });

        if (isLocal &gt; -1) {
            newData.id = tempKeys[isLocal].remoteId;
        }

        if (!newData.id &amp;&amp; this.childID) {
            newData.id = this.childID;
        }

        // assume existing record to be updated.
        if (newData.id) {

            fieldCollection.push({
                &quot;_Name&quot;: &quot;ID&quot;,
                &quot;__text&quot;: newData.id
            });

            method = &quot;Update&quot;;
        }
        // create a new record, because there is no id.
        else {
            fieldCollection.push({
                &quot;_Name&quot;: &quot;ID&quot;,
                &quot;__text&quot;: &apos;New&apos;
            });
            method = &apos;New&apos;;
        }

        for (var prop in newData) {
            let fieldValue = newData[prop];
            if (prop == &quot;id&quot; || typeof(fieldValue) == &quot;undefined&quot;) continue;
            if (prop == &quot;priority&quot; || prop == &quot;_temporary-identifier&quot; || prop == &quot;remoteId&quot;) continue;
            if (typeof fieldValue === &apos;object&apos;) {
                if (fieldValue.id &amp;&amp; fieldValue.value) {
                    /* This is a SharePoint lookup type field. We must write it as a specially formatted value instead of an id/value object. */
                    fieldValue = `${fieldValue.id};#`;
                } else if (fieldValue.length !== undefined &amp;&amp; fieldValue[0] &amp;&amp; fieldValue[0].id &amp;&amp; fieldValue[0].value) {
                    /* This is a SharePoint LookupMulti field. It is specially formatted like above. */
                    let IDs = _.pluck(fieldValue, &apos;id&apos;);
                    fieldValue = IDs.join(&apos;;#;#&apos;);
                } else {
                    continue;
                }
            }


            fieldCollection.push({
                &quot;_Name&quot;: prop,
                &quot;__text&quot;: fieldValue
            });
        }

        configuration.params = {
            &quot;listName&quot;: this.settings.listName,
            &quot;updates&quot;: {
                &quot;Batch&quot;: {
                    &quot;Method&quot;: {
                        &quot;Field&quot;: fieldCollection,

                        &quot;_ID&quot;: &quot;1&quot;,
                        &quot;_Cmd&quot;: method
                    },

                    &quot;_OnError&quot;: &quot;Continue&quot;,
                    &quot;_ListVersion&quot;: &quot;1&quot;,
                    &quot;_ViewName&quot;: &quot;&quot;
                }
            }
        };

        // initial initialisation of the datasource
        (function (newData) {
            soapClient.call(configuration, tempKeys)
                .then((result)=&gt; {

                    let data = this._getResults(result.data);
                    if (data.length == 1) {
                        let remoteId = data[0].id;

                        // push ID mapping for given session to collection of temp keys
                        if (newData[&apos;_temporary-identifier&apos;]) {
                            tempKeys.push({
                                localId: newData[&apos;_temporary-identifier&apos;],
                                remoteId: remoteId,
                                client: this
                            });
                        }
                        let messages = this._updateCache(data);
                        for (let message of messages) {
                            this.emit(&apos;message&apos;, message);
                        }

                        /* Fire a value/child_changed event with the now available remoteId present */
                        let model = newData;
                        model.id = model[&apos;_temporary-identifier&apos;] || model.id;
                        model.remoteId = remoteId;
                        if (this.isChild) {
                            /* TODO: re-enable value emit on children when child subscriptions are implemented */
                            //this.emit(&apos;message&apos;, {event: &apos;value&apos;, result: model});
                        } else {
                            this.emit(&apos;message&apos;, {event: &apos;child_changed&apos;, result: model});
                            this.emit(&apos;message&apos;, {event: &apos;value&apos;, result: this.cache});
                        }
                    }
                }, (error) =&gt; {
                    console.log(error);
                });
        }.bind(this))(newData);
    }

    /**
     * Remove a record from SharePoint
     * @param record
     * @private
     */
    _handleRemove(record) {
        var configuration = this._updateListItemsDefaultConfiguration();
        /* Append the listName to the URL for easy debugging */
        configuration.url = this._parsePath(this.settings.endPoint, this._getListService()) + `?remove=${this.settings.listName}`;
        var fieldCollection = [];

        record.remoteId = record.id;

        let isLocal = _.findIndex(tempKeys, function (key) {
            return key.localId == record.id;
        });

        if (isLocal &gt; -1) {
            record.id = tempKeys[isLocal].remoteId;
        }

        fieldCollection.push({
            &quot;_Name&quot;: &quot;ID&quot;,
            &quot;__text&quot;: record.id
        });

        configuration.params = {
            &quot;listName&quot;: this.settings.listName,
            &quot;updates&quot;: {
                &quot;Batch&quot;: {
                    &quot;Method&quot;: {
                        &quot;Field&quot;: fieldCollection,

                        &quot;_ID&quot;: &apos;1&apos;,
                        &quot;_Cmd&quot;: &apos;Delete&apos;
                    },

                    &quot;_OnError&quot;: &apos;Continue&apos;,
                    &quot;_ListVersion&quot;: &apos;1&apos;,
                    &quot;_ViewName&quot;: &apos;&apos;
                }
            }
        };

        // initial initialisation of the datasource
        soapClient.call(configuration, tempKeys)
            .then(()=&gt; {
                this.emit(&apos;message&apos;, {event: &apos;child_removed&apos;, result: record});
            }, (error) =&gt; {
                console.log(error);
            });
    }


    /**
     * Update our cache and bubble child_added or child_changed events
     * @param data
     * @private
     */
    _updateCache(data) {
        let messages = [];
        for (let record in data) {
            let shouldUseRemoteId = false;
            let model = data[record];
            model.remoteId = model.id;

            let localIndex = _.findIndex(tempKeys, function (key) {
                return key.remoteId == model.id;
            });

            if (localIndex &gt; -1) {
                let tempKey = tempKeys[localIndex];

                /* If this SPClient instance created the temp ID, we need to use it in our events.
                 * Otherwise, we should use the remote ID that SharePoint generated. */
                shouldUseRemoteId = tempKey.client !== this;
                model.id = shouldUseRemoteId ? model.remoteId : tempKey.localId;
            }

            let cacheIndex = _.findIndex(this.cache, function (item) {
                return model.id == item.id;
            });

            if (cacheIndex === -1) {
                this.cache.push(model);

                let previousSiblingId = this.cache.length == 0 ? null : this.cache[this.cache.length - 1];
                messages.push({
                    event: &apos;child_added&apos;,
                    result: model,
                    previousSiblingId: previousSiblingId ? previousSiblingId.id : null
                });
            }
            else {
                if (!_.isEqual(model, this.cache[cacheIndex])) {
                    this.cache[cacheIndex] = model;

                    let previousSibling = cacheIndex == 0 ? null : this.cache[cacheIndex - 1];
                    messages.push({
                        event: &apos;child_changed&apos;,
                        result: model,
                        previousSiblingId: previousSibling ? previousSibling.id : null
                    });
                }
            }
        }
        return messages;
    }


    /**
     * Update the last polling timestamp so we only get the latest changes.
     * @param newDate
     * @private
     */
    _activateChangeToken(lastChangeToken) {
        this.retriever.params.changeToken = lastChangeToken;
    }

    _setNextPage(nextPaginationToken) {
        this.retriever.params.queryOptions.QueryOptions.Paging = {_ListItemCollectionPositionNext: nextPaginationToken};
    }

    _clearNextPage() {
        delete this.retriever.params.queryOptions.QueryOptions.Paging;
    }

    _deactivateChangeToken() {
        delete this.retriever.params.changeToken;
    }


    _handleNextToken(listItem) {
        let lastQueryHadPagination = this.retriever.params.queryOptions.QueryOptions.Paging;

        if (!lastQueryHadPagination &amp;&amp; listItem.Changes) {
            this.lastChangeToken = listItem.Changes[0].$.LastChangeToken;
        }

        if (this._isLimitExceeded()) {
            this._clearNextPage();
            this._activateChangeToken(this.lastChangeToken);
        } else {
            let {ListItemCollectionPositionNext: nextPaginationToken} = listItem[&quot;rs:data&quot;][0].$;

            if (nextPaginationToken !== undefined) {
                this._setNextPage(nextPaginationToken);
                this._deactivateChangeToken();
            } else {
                this._clearNextPage();
                this._activateChangeToken(this.lastChangeToken);
            }
        }
    }


    _handleDeleted(result) {

        let changes = result.Id || null;

        if (changes &amp;&amp; changes.length &gt; 0) {

            for (let change in changes) {

                if (changes[change].$.ChangeType == &quot;Delete&quot;) {

                    let recordId = changes[change]._;

                    let localIndex = _.findIndex(tempKeys, function (key) {
                        return key.remoteId == recordId;
                    });

                    if (localIndex &gt; -1) {
                        let tempKey = tempKeys[localIndex];
                        let isOurTempKey = tempKey.client === this;
                        recordId = isOurTempKey ? tempKey.localId : tempKey.remoteId;
                    }

                    let cacheItem = _.findIndex(this.cache, function (item) {
                        return item.id == recordId;
                    });

                    this.emit(&apos;message&apos;, {
                        event: &apos;child_removed&apos;,
                        result: this.cache[cacheItem]
                    });
                    this.cache.splice(cacheItem, 1);
                }
            }

            return true;
        }

        return false;
    }

    /**
     * Parse SharePoint response into formatted records
     * @param result
     * @returns {Array}
     * @private
     */
    _getResults(result) {

        let arrayOfObjects = [];
        let node = null;


        if (result[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].GetListItemChangesSinceTokenResponse) {

            node = result[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].GetListItemChangesSinceTokenResponse[0].GetListItemChangesSinceTokenResult[0].listitems[0][&quot;rs:data&quot;][0];

            if (node) {
                if (node.$.ItemCount !== &apos;0&apos;) {
                    for (let row in node[&apos;z:row&apos;]) {
                        let raw = node[&apos;z:row&apos;][row].$;
                        let record = this._formatRecord(raw);
                        arrayOfObjects.push(record);
                    }
                }
            }
        }
        else if (result[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].UpdateListItemsResponse) {

            // check for error
            let error = result[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].UpdateListItemsResponse[0].UpdateListItemsResult[0].Results[0].Result[0].ErrorCode;
            if (error == &apos;0x00000000&apos;) {
                node = result[&quot;soap:Envelope&quot;][&quot;soap:Body&quot;][0].UpdateListItemsResponse[0].UpdateListItemsResult[0].Results[0];
                if (node) {
                    for (let row in node.Result) {
                        let raw = node.Result[row][&quot;z:row&quot;][0].$;
                        let record = this._formatRecord(raw);
                        arrayOfObjects.push(record);
                    }
                }
            }
        }

        return arrayOfObjects;
    }

    /**
     * Strip SharePoint record from SharePoint specifics
     * @param record
     * @returns {{}}
     * @private
     */
    _formatRecord(record) {
        let result = {};
        for (let attribute in record) {

            let name = attribute.replace(&apos;ows_&apos;, &apos;&apos;);
            if (name == &apos;xmlns:z&apos;) {
                continue;
            }

            let value = record[attribute];
            if (value === &apos;&apos;) {
                continue;
            }

            if (name == &quot;ID&quot;) {
                name = &quot;id&quot;;
                result[name] = value;
            } else if (value.indexOf(&quot;;#&quot;) &gt; -1) {
                var keys = value.split(&quot;;#&quot;);
                var pairs = keys.length / 2;
                var assignable = pairs &gt; 1 ? [] : {};
                for (var pair = 0; pair &lt; keys.length; pair += 2) {
                    if (pairs &gt; 1) assignable.push({id: keys[pair], value: keys[pair + 1]});
                    else assignable = {id: keys[pair], value: keys[pair + 1]};
                }
                result[name] = assignable;
            } else if (!isNaN(value)) {
                /* Map a number when that number is detected */
                result[name] = parseFloat(value);
            } else {
                /* By default map the attribute 1:1 */
                result[name] = value;
            }
        }

        return result;
    }


    /**
     * Double check if given path is a valid path
     * @param path
     * @param endPoint
     * @returns {string}
     * @private
     */
    _parsePath(path = &apos;&apos;, endPoint = &apos;&apos;) {

        var url = UrlParser(path);
        if (!url) console.log(&apos;Invalid datasource path provided!&apos;);

        var pathParts = url.path.split(&apos;/&apos;);
        var newPath = url.protocol + &apos;://&apos; + url.host + &apos;/&apos;;
        for (var i = 0; i &lt; pathParts.length; i++)
            newPath += pathParts[i] + &apos;/&apos;;
        newPath += endPoint;
        return newPath;
    }


    /**
     * Get Default resource for Updating Lists
     * @returns {{url: string, service: string, method: string, params: string, headers: (Map|*)}}
     * @private
     */
    _updateListItemsDefaultConfiguration() {
        return {
            url: &apos;&apos;,
            service: &apos;Lists&apos;,
            method: &apos;UpdateListItems&apos;,
            params: &apos;&apos;,
            headers: new Map([
                [&apos;SOAPAction&apos;, &apos;http://schemas.microsoft.com/sharepoint/soap/UpdateListItems&apos;],
                [&apos;Content-Type&apos;, &apos;text/xml&apos;]
            ])
        };
    }


    /**
     * Get Default resource for Reading Lists
     * @returns {{url: string, service: string, method: string, params: string, headers: (Map|*)}}
     * @private
     */
    _getListItemsDefaultConfiguration() {
        return {
            url: &apos;&apos;,
            service: &apos;Lists&apos;,
            method: &apos;GetListItemChangesSinceToken&apos;,
            params: &apos;&apos;,
            headers: new Map([
                [&apos;SOAPAction&apos;, &apos;http://schemas.microsoft.com/sharepoint/soap/GetListItemChangesSinceToken&apos;],
                [&apos;Content-Type&apos;, &apos;text/xml&apos;]
            ])
        };
    }


    /**
     * Get Default resource for Reading Lists
     * @returns {{url: string, service: string, method: string, params: string, headers: (Map|*)}}
     * @private
     */
    _getUserGroupDefaultConfiguration() {
        return {
            url: &apos;&apos;,
            service: &apos;UserGroup&apos;,
            method: &apos;GetCurrentUserInfo&apos;,
            params: &apos;&apos;,
            headers: new Map([
                [&apos;SOAPAction&apos;, &apos;http://schemas.microsoft.com/sharepoint/soap/directory/GetCurrentUserInfo&apos;],
                [&apos;Content-Type&apos;, &apos;text/xml&apos;]
            ])
        };
    }


    /**
     * Default interface for Get list
     * @returns {string}
     * @private
     */
    _getListService() {
        return &apos;_vti_bin/Lists.asmx&apos;;
    }


    /**
     * Default interface for Update list
     * @returns {string}
     * @private
     */
    _getUserGroupService() {
        return &apos;_vti_bin/UserGroup.asmx&apos;;
    }

    /* Ignores all paths ending in a numeric value. These paths don&apos;t contain an array, but rather a specific child.
     * Binding to specific children is not supported by the SharePoint interface, and shouldn&apos;t be necessary either
     * because there is a subscription to child_changed events on the parent array containing this child. */
    _isChildItem(path) {
        if (path[path.length - 1] === &apos;/&apos;) {
            path = path.substring(0, path.length - 2);
        }

        let parts = path.split(&apos;/&apos;);
        if (parts.length) {
            let lastArgument = parts[parts.length - 1];

            let isNumeric = (n) =&gt; !isNaN(parseFloat(n)) &amp;&amp; isFinite(n);

            if (isNumeric(lastArgument) || lastArgument.indexOf(Settings.localKeyPrefix) === 0) {
                this.childID = lastArgument;
                return true;
            } else {
                return false;
            }
        }
        return true;
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.0-alpha)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
